<!DOCTYPE html>
<html class="no-js css-menubar" lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
  <meta name="description" content="bootstrap admin template">
  <meta name="author" content="">

  <title>Account Visit Details</title>

  <link rel="apple-touch-icon" href="../assets/images/apple-touch-icon.png">
  <link rel="shortcut icon" href="../assets/images/fav.ico">

  <!-- Stylesheets -->
   <link rel="manifest" href="../manifest.json">
  <link rel="stylesheet" href="../global/css/bootstrap.min.css">
  <link rel="stylesheet" href="../global/css/bootstrap-extend.min.css">
  <link rel="stylesheet" href="../assets/css/site.min.css">

  <!-- Plugins -->
  <link rel="stylesheet" href="../global/vendor/animsition/animsition.css">
  <link rel="stylesheet" href="../global/vendor/asscrollable/asScrollable.css">
  <link rel="stylesheet" href="../global/vendor/switchery/switchery.css">
  <link rel="stylesheet" href="../global/vendor/intro-js/introjs.css">
  <link rel="stylesheet" href="../global/vendor/slidepanel/slidePanel.css">
  <link rel="stylesheet" href="../global/vendor/flag-icon-css/flag-icon.css">
  <link rel="stylesheet" href="../assets/examples/css/pages/invoice.css">


  <!-- Fonts -->
  <link rel="stylesheet" href="../global/fonts/web-icons/web-icons.min.css">
  <link rel="stylesheet" href="../global/fonts/brand-icons/brand-icons.min.css">
  <link rel='stylesheet' href='http://fonts.googleapis.com/css?family=Roboto:300,400,500,300italic'>
  <link rel="stylesheet" href="../global/fontawesome/css/all.min.css" />
  <!--[if lt IE 9]>
    <script src="../global/vendor/html5shiv/html5shiv.min.js"></script>
    <![endif]-->

  <!--[if lt IE 10]>
    <script src="../global/vendor/media-match/media.match.min.js"></script>
    <script src="../global/vendor/respond/respond.min.js"></script>
    <![endif]-->

  <!-- Scripts -->
  <script src="../global/vendor/breakpoints/breakpoints.js"></script>
  <script>
    Breakpoints();
  </script>
</head>

<body class="animsition page-invoice">
  <!--[if lt IE 8]>
        <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->



  <!-- Page -->



  <div id="pg" class="page-content">
    <!-- Panel -->
    <div class="panel">
      <div class="panel-body container-fluid">


        <div class="row">
          <div class="col-lg-3">
            <h3 id="name"></h3>
            <address>
              <span><i class="fas fa-map-marker-alt"></i> <strong>District: </strong> </span><span id="district"></span>
              <br>
              <span><i class="fas fa-map-marker-alt"></i> <strong>Address: </strong></span><span id="address"></span>
              <br>
              <span><i class="fas fa-envelope-open-text"></i> <strong>E-mail: </strong> </span><span id="mail"></span>
              <br>
              <span><i class="fas fa-phone-alt"></i> <strong>Phone: </strong></span><span id="phone"></span>
            </address>
          </div>

        </div>
        <hr style="border-color: gray; border-style: dotted;">
        <div class="page-invoice-table table-responsive">
          <table class="table table-hover">
            <thead>
              <colgroup>
                <col span="1" style="width: 10%;">
                <col span="1" style="width: 90%;">
              </colgroup>
            </thead>
            <tbody>
              <tr>

                <td class="text-left">
                  <strong>Account Type:</strong>
                </td>
                <td class="text-left" id="accounttype">

                </td>
              </tr>

              <tr>

                <td class="text-left">
                  <strong>Purchase Type:</strong>

                </td>
                <td class="text-left" id="purchasetype">

                </td>
              </tr>

              <tr>

                <td class="text-left">
                  <strong>Category:</strong>

                </td>
                <td class="text-left" id="category">

                </td>
              </tr>
              <tr>

                <td class="text-left">
                  <strong>Number Of Doctors:</strong>

                </td>
                <td class="text-left" id="numberofdoctors">

                </td>
              </tr>
              <tr class="text-left">
                <td>
                  <strong>Visit Date:</strong>
                </td>
                <td id="date">

                </td>
              </tr>
              <tr class="text-left">
                <td>
                  <strong>Visit Time:</strong>
                </td>
                <td id="time">

                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <hr style="border-color: gray; border-style: dotted;">
        <div class="row">
          <div class="page-invoice-table table-responsive col-6">
            <table class="table table-hover text-center">
              <thead>
                <tr>
                  <th>-</th>
                  <th>-</th>
                </tr>
                <tr>
                  <th>Products</th>
                </tr>
              </thead>
              <tbody id="products">

              </tbody>
            </table>
          </div>


          <div class="page-invoice-table table-responsive col-6">
            <table class="table table-hover text-center">
              <thead>

                <tr>
                  <th colspan="2">Persons Met</th>
                </tr>
                <tr>
                  <th>Name</th>
                  <th>Position</th>
                </tr>
              </thead>
              <tbody id="persons">

              </tbody>
            </table>
          </div>





        </div>




        <hr style="border-color: gray; border-style: dotted;">
        <div class="page-invoice-table table-responsive col-lg-12">
          <table class="table table-hover">
            <thead>
              <colgroup>
                <col span="1" style="width: 10%;">
                <col span="1" style="width: 90%;">
              </colgroup>
            </thead>
            <tbody>
              <tr>

                <td class="text-left">
                  <strong>Relationship Note: </strong>
                </td>
                <td class="text-left" id="visitnotes"></td>
              </tr>
              <tr>

                <td class="text-left">
                  <strong>Additional Note: </strong>

                </td>
                <td class="text-left" id="paymentnotes"></td>
              </tr>
            </tbody>
          </table>
        </div>







        <div class="text-right">

          <button type="button" id="print" class="btn btn-animate btn-animate-side btn-primary btn-outline">
            <span><i class="icon wb-print" aria-hidden="true"></i> Print</span>
          </button>
          <button type="button" id="excel" class="btn btn-animate btn-animate-side btn-success btn-outline">
            <span><i class="icon fas fa-file-excel" aria-hidden="true"></i> Export To Excel</span>
          </button>

        </div>
      </div>
    </div>
    <!-- End Panel -->
  </div>

  <!-- End Page -->


  <!-- Footer -->

  <!-- Core  -->
  <script src="../global/vendor/babel-external-helpers/babel-external-helpers.js"></script>
  <script src="../global/vendor/jquery/jquery.js"></script>
  <script src="../global/vendor/popper-js/umd/popper.min.js"></script>
  <script src="../global/vendor/bootstrap/bootstrap.js"></script>
  <script src="../global/vendor/animsition/animsition.js"></script>
  <script src="../global/vendor/mousewheel/jquery.mousewheel.js"></script>
  <script src="../global/vendor/asscrollbar/jquery-asScrollbar.js"></script>
  <script src="../global/vendor/asscrollable/jquery-asScrollable.js"></script>
  <script src="../global/vendor/ashoverscroll/jquery-asHoverScroll.js"></script>

  <!-- Plugins -->
  <script src="../global/vendor/switchery/switchery.js"></script>
  <script src="../global/vendor/intro-js/intro.js"></script>
  <script src="../global/vendor/screenfull/screenfull.js"></script>
  <script src="../global/vendor/slidepanel/jquery-slidePanel.js"></script>

  <!-- Scripts -->
  <script src="../global/js/Component.js"></script>
  <script src="../global/js/Plugin.js"></script>
  <script src="../global/js/Base.js"></script>
  <script src="../global/js/Config.js"></script>
  <script src="../global/fontawesome/js/all.min.js"></script>
  <script src="../assets/js/Section/Menubar.js"></script>
  <script src="../assets/js/Section/GridMenu.js"></script>
  <script src="../assets/js/Section/Sidebar.js"></script>
  <script src="../assets/js/Section/PageAside.js"></script>
  <script src="../assets/js/Plugin/menu.js"></script>
  <script src="../global/js/config/colors.js"></script>
  <script src="../assets/js/config/tour.js"></script>
  <script>Config.set('assets', '../assets');</script>

  <!-- Page -->
  <script src="../assets/js/Site.js"></script>
  <script src="../global/js/Plugin/asscrollable.js"></script>
  <script src="../global/js/Plugin/slidepanel.js"></script>
  <script src="../global/js/Plugin/switchery.js"></script>
  <script src="../global/jspdf.min.js"></script>

  <script src="https://cdn.jsdelivr.net/alasql/0.3/alasql.min.js"></script>
  <script src="../global/xlsx.full.min.js"></script>
  <script>
    (function (document, window, $) {
      'use strict';

      var Site = window.Site;
      $(document).ready(function () {
        Site.run();



        //start layout            
        if (localStorage.getItem("userrole") !== "System Admin") {
          window.open("../notauth.html", "_self")
        }

        $("#FullName").append(localStorage.getItem("userfullname") + ' <span><i class="icon wb-chevron-down-mini" aria-hidden="true"></i></span>');



        $(".logout").click(function (e) {
          e.preventDefault();
          $.ajax({
            url: "http://localhost:53586/users/LogOut",
            success: function (res) {
              if (res == true) {
                window.localStorage.removeItem("userfullname");
                      window.localStorage.removeItem("useremail");
                      window.localStorage.removeItem("userid");
                      window.localStorage.removeItem("userrole");
                window.open("../index.html", "_self")
              }
              else {
                window.open("../error.html", "_self")
              }
            }
          })
        })
        //end layout

        var visitId = window.location.search.substring(1);



        function formatTimeShow(h_24) {
          var h = h_24 % 12;
          return (h < 10 ? '0' : '') + h;
        }

        var accountname;
        var districtname;
        var email;
        var phonenumber;
        var accounttypename;
        var purchasetypename;
        var categoryname;
        var numberofdoctors;
        var visitdate;
        var visittime;
        var visitnotes;
        var additionalnotes;
        var products = [];
        var persons = [];



        $.ajax({
          url: "http://localhost:53586/AccountMedicalVisit/GetVisitById/" + visitId,
          success: function (res) {


            $("#name").append(res.accountName);
            $("#district").append(res.districtName);
            $("#address").append(res.address);
            $("#mail").append(res.email);
            $("#phone").append(res.phoneNumber);
            $("#accounttype").append(res.accountTypeName);
            $("#purchasetype").append(res.purchaseTypeName)
            $("#category").append(res.categoryName);
            $("#numberofdoctors").append(res.numberOfDoctors)
            res.visitDate = res.visitDate.substring(0, 10)
            $("#date").append(res.visitDate);




            var tt = res.visitTime.substring(11, 16);
            var h = tt.substring(0, 2);
            var m = tt.substring(3);
            if (h == 0) {
              tt = "12:" + m + " AM";
              res.visitTime = tt;
            }
            if (h == 12) {
              tt = "12:" + m + " PM"
              res.visitTime = tt;
            }
            if (h > 12) {
              var newh = formatTimeShow(h);
              res.visitTime = newh + ":" + m + " PM";
            }
            if (h < 12 && h != 0) {
              res.visitTime = tt + " AM";
            }

            $("#time").append(res.visitTime)

            $.each(res.product, function () {
              $("#products").append('<tr><td>' + this.productName + '</td></tr>')
              
              var obj = {"Product":this.productName}
              products.push(obj);
            })



            $.each(res.person, function () {
              $("#persons").append('<tr><td>' + this.personName + '</td><td>' + this.personPosition + '</td></tr>')
              var obj = {'PersonName':this.personName,'PersonPosition':this.personPosition};
              persons.push(obj);
            })
            $("#visitnotes").append(res.visitNotes)
            $("#paymentnotes").append(res.additionalNotes)



            accountname = res.accountName;
            districtname = res.districtName;
            email = res.email;
            phonenumber = res.phoneNumber;
            accounttypename = res.accountTypeName;
            purchasetypename = res.purchaseTypeName;
            categoryname = res.categoryName;
            numberofdoctors = res.numberOfDoctors;
            visitdate = res.visitDate;
            visittime = res.visitTime;
            visitnotes = res.visitNotes;
            additionalnotes = res.additionalNotes;





          }
        })


        $("#print").click(function () {
          $("#print").addClass('d-none');


          window.print();

          var delay = 1;


          setTimeout(function () { $("#print").removeClass('d-none'); }, delay);


        })


        // var accountname;
        // var districtname;
        // var email;
        // var phonenumber;
        // var accounttypename;
        // var purchasetypename;
        // var categoryname;
        // var numberofdoctors;
        // var visitdate;
        // var visittime;
        // var visitnotes;
        // var additionalnotes;
        // var products = [];
        // var persons = [];


        $("#excel").click(function () {

          var data1 = [{"Account Name":accountname,"District Name":districtname,"Email":email,"Phone Number":phonenumber,"Account Type":accounttypename,"Purchase Type":purchasetypename,"Category":categoryname,"Number Of Doctors":numberofdoctors,"Visit Date":visitdate,"Visit Time":visittime,"Visit Notes":visitnotes,"Additional Notes":additionalnotes}];
       
          var opts = [{ sheetid: 'General Visit Info', header: true },{ sheetid: 'Products', header: true },{ sheetid: 'Persons Met', header: true }];
          var res = alasql('SELECT INTO XLSX("'+accountname+' Visit Details '+visitdate+'.xlsx",?) FROM ?',
            [opts, [data1,products,persons]]);

        })



      });
    })(document, window, jQuery);
  </script>
</body>

</html>